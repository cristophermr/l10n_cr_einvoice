<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <!-- Inherit Form view -->
  <record id="l10n_cr_einvoice.account_move_form" model="ir.ui.view">
    <field name="name">l10n_cr_einvoice.account.move.form</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="account.view_move_form"/>
    <field name="arch" type="xml">

      <xpath expr="//div[@class='oe_title']" position="after">
        <h4><field name="fe_clave" readonly="1"
                   attrs="{ 'invisible': [  ( 'move_type', 'not in', ['out_invoice', 'out_refund'] )  ] }"
        /></h4>
      </xpath>
        
      <xpath expr="//field[@name='payment_reference']" position="after">
          <field name="move_type_extra"
                 attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice')  ) ]}"/>
          <field name="fe_payment_type" string="Medio de Pago"
                 attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice')  ) ]}"/>
          <field name="fe_receipt_status"
                 attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice')  ) ]}"/>
          <field name="fe_activity_code_id" options="{'no_create': True, 'no_create_edit': True}"
                 attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice')  ) ]}"/>
      </xpath>


      <xpath expr="//page[last()]" position="after">
        <page string="Facturacion Electrónica CR" attrs="{'invisible': [('move_type_extra', '=', False)]}">
          <form>
            <!--
            <group>
              <button name='get_invoice' string="consultar"  type="object" class="oe_highlight" />
            </group>
            -->
           <group>
              <!-- <button name='confirm_bill' string="Crear XML"  type="object" class="oe_highlight" /> -->
               <button name='create_xml' string="Crear XML"  type="object" class="oe_highlight" />
               <button name='hacienda_post_json' string="Enviar Hacienda"  type="object" class="oe_highlight" />
               <button name='query_hacienda' string="Consultar Hacienda"  type="object" class="oe_highlight" />
           </group>
           <group>
              <field name="fe_name_xml_sign" invisible='1'/>
              <field name="fe_name_xml_hacienda" invisible='1'/>
              <field name="fe_xml_sign" filename='fe_name_xml_sign' options="{'filename': 'fe_name_xml_sign'}"/>
              <field name="fe_xml_hacienda" filename='fe_name_xml_hacienda' options="{'filename': 'fe_name_xml_hacienda'}"/>
           </group>
           <group>

              <field name="inforef_ids" string="Información de Referencia"> 
                  <tree editable="bottom">
                      <field name="tipodoc" placeholder="Selecione el Tipo de Documento" string="Tipo Documento Referencia"/>
                      <field name="numero" placeholder="Numero"/>
                      <field name="fecha_emision" placeholder="Fecha Emision"/>
                      <field name="codigo" placeholder="Seleccione ... "/>
                      <field name="razon" placeholder="Razon ...."/>
                  </tree>                                  
              </field>

              <field name="otros_ids" string="Otros"> 
                 <tree editable="bottom">
                      <field name="field_type" placeholder="Selecione Tipo"/>
                      <field name="attributes_data" placeholder="atributo1=&quot;valor1&quot; atributo2=&quot;valor2&quot;"
                        attrs=" {  'invisible': [  ( 'field_type', 'not in', ['OtroTexto'] )  ]  }  "
                        string="Atributos y sus valores" />
                      <field name="field_data" placeholder="Datos del Campo" string="Texto de Otros"/>
                  </tree>                                  
              </field>

           </group>
           <group>
              <field name="other_attachments_ids" string="Adjuntos adicionales"> 
                  <tree editable="bottom">
                      <field name="datas"  filename="name" widget="binary" />
                      <field name="name" invisible="1"/>
                      <field name="description" placeholder="Descripción"/>
                  </tree>                                  
              </field>               
           </group>
              
           <group>
               <field name="fe_tohacienda_json" string="JSON hacia Hacienda" groups="base.group_no_one"/>
               <field name="fe_fromhacienda_json" string="JSON respuesta Hacienda" groups="base.group_no_one"/>
               <field name="fe_fromhacienda_xml_html" string="Respuesta Hacienda"/>
           </group>

          </form>
        </page>
      </xpath>

      <xpath expr="//div[@name='journal_div']" position="after">
        <field name="fe_server_state" />
        <label for="exchange_rate"
               attrs="{'invisible': [('move_type', 'not in', ['out_invoice','out_refund','in_invoice','in_refund'])]}" />
        <div attrs="{'invisible': [('move_type', 'not in', ['out_invoice','out_refund','in_invoice','in_refund'])]}">
          <field name="exchange_rate" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
          <span> &amp;nbsp; &amp;nbsp;</span>
          <field name="exchange_rate_date" readonly="1"/>
        </div>
      </xpath>

      <xpath expr="//field[@name='invoice_payments_widget']" position="before"> 
        <field name="exchange_rate" widget="monetary" options="{'currency_field': 'company_currency_id'}"/>
      </xpath>
      <!--
      <xpath expr="//field[@name='invoice_outstanding_credits_debits_widget']" position="after"> 
        <field name="otros_ids"> 
          <tree editable="bottom">
              <field name="field_type" placeholder="Selecione Otro Texto/Contenido"/>
              <field name="attributes_data" placeholder="Atributo1=&quot;valor1&quot; Atributo2=&quot;valor2&quot;"
                attrs=" {  'invisible': [  ( 'field_type', 'not in', ['OtroContenido'] )  ]  }  "
                string="Atributos y sus valores" />
              <field name="field_data" placeholder="Datos del Campo" string="Texto de Otros"/>
          </tree>                                  
        </field>

        <field name="inforef_ids"> 
          <tree editable="bottom">
              <field name="tipodoc" placeholder="Selecione el Tipo de Documento" string="Tipo Documento Reerencia"/>
              <field name="numero" placeholder="Numero"/>
              <field name="fecha_emision" placeholder="Fecha Emision"/>
              <field name="codigo" placeholder="Codigo"/>
              <field name="razon" placeholder="Razon ...."/>
          </tree>                                  
        </field>
      </xpath>
      -->

    </field>

  </record>
</odoo>

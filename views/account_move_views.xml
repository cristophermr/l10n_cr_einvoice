<?xml version="1.0" encoding="UTF-8"?>
<odoo>
<!-- Inherit Form view -->
<record id="l10n_cr_einvoice.account_move_form" model="ir.ui.view">
  <field name="name">l10n_cr_einvoice.account.move.form</field>
  <field name="model">account.move</field>
  <field name="inherit_id" ref="account.view_move_form"/>
  <field name="arch" type="xml">
      
      <xpath expr="//header/button[@name='action_reverse']" position="after">
            <button name="mostrar_wizard_nota_debito" type="object" string="Add Debit Note"
            attrs="{'invisible': ['|', ('type', 'not in', ['out_invoice','in_invoice']), ('state','!=','posted')]}"/>
      </xpath>
      <field name="product_uom_id" position="attributes">
        <attribute name="groups"></attribute>
      </field>
      <xpath expr="//page[last()]" position="after">
        <field name ="fe_current_country_company_code" invisible="1"/>
        <page string="Facturacion electrÃ³nica" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}">
          <form>
            <group>
              <button name='get_invoice' string="consultar"  type="object" class="oe_highlight" />
            </group>
            <group>
              <button name='confirm_bill' string="Enviar a Hacienda"  type="object" class="oe_highlight" />
            </group>
            <group>
              <field name="fe_name_xml_sign" invisible='1'/>
              <field name="fe_name_xml_hacienda" invisible='1'/>
              <field name="fe_xml_sign" filename='fe_name_xml_sign' options="{'filename': 'fe_name_xml_sign'}"/>
              <field name="fe_xml_hacienda" filename='fe_name_xml_hacienda' options="{'filename': 'fe_name_xml_hacienda'}"/>
            </group>
          </form>
        </page>
      </xpath>
      <!--<xpath expr="//sheet/h1" position="after">
          <h3><field name="fe_clave" readonly="1"/></h3>
      </xpath>-->
      
     <field name="name" position="after">
            <h3><field name="fe_clave" readonly="1" attrs="{'invisible': [('state','=','draft')]}" /></h3>
            <field name="fe_clave" invisible="1"/>
      </field>

      <field name="journal_id" position="replace">
        <field name="journal_id"  options="{'no_create': True}" domain="[('type', '=?', invoice_filter_type_domain)]" attrs="{'invisible': [('fe_current_country_company_code', '!=', 'CR')]}"/>
        <field name="fe_doc_ref" attrs="{'invisible': ['|',('fe_in_invoice_type','=','OTRO'),('type','!=','in_invoice')]}"/>
        <field name="fe_tipo_documento_referencia" attrs="{'invisible': ['|',('fe_in_invoice_type','=','OTRO'),('type','!=','in_invoice')],'required':[('fe_doc_ref','!=',False)]'}"/>
        <field name="fe_informacion_referencia_codigo" attrs="{'invisible': ['|',('fe_in_invoice_type','=','OTRO'),('type','!=','in_invoice')],'required':[('fe_doc_ref','!=',False)]'}"/> 
        <field name="fecha_factura_simplificada" attrs="{'invisible': ['|',('fe_in_invoice_type','=','OTRO'),('type','!=','in_invoice')],'required':[('fe_doc_ref','!=',False)]'}"/>    
      </field>
      
      <xpath expr="//form[1]/sheet[1]/group[1]" position="after">
            <group>
              <group>
                  <field name="electronic_doc_id" attrs="{'invisible': [('fe_in_invoice_type','!=','OTRO')]}" />
              </group>
            </group>
      </xpath>
      
      <field name="ref" position="after">
          <field name ='fe_in_invoice_type' invisible = 'True' />
          <field name = "fe_payment_type"  attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}"/>
          <field name = "fe_receipt_status" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}"/>
          <field name = "fe_activity_code_id"  domain="[('company_id', '=', company_id)]" options="{'no_create': True, 'no_create_edit': True,'no_open': True,}" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}"/>
          <field name="fe_server_state" readonly='1' attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}"/>
          <field name = "fe_currency_rate" readonly="1" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}"/>
      </field>
      <!--<div groups="base.group_multi_currency" position="after">
        <field name = "fe_currency_rate" readonly="1"/>
      </div>-->
      <!--Vendor bill-->
      <field name="narration" nolabel="1" height="50" position="after">
         <field name = "fe_xml_supplier_xslt" readonly="1" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('fe_in_invoice_type','=','OTRO')]}"/>
         <field name = "fe_xml_supplier_xslt" invisible="1"/>
      </field>

  </field>
</record>

    
 <!-- Inherit Form view  credit note -->   
<record id="l10n_cr_einvoice.account_move_form_credit_note" model="ir.ui.view">
    <field name="name">l10n_cr_einvoice.account.move.form.credit.note</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="account.view_move_form"/>
    <field name="arch" type="xml">
      <field name="journal_id" position="after">
        <field name = 'debit_note' invisible="True"/>
        <field name ="fe_current_country_company_code" invisible="1"/>
        <field name="fe_doc_ref" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('type','!=','out_refund'),('debit_note','=',False)]}"/>
        <field name="fe_tipo_documento_referencia" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('type','!=','out_refund'),('debit_note','=',False)]}"/>
        <field name="fe_informacion_referencia_codigo" attrs="{'invisible': ['|',('fe_current_country_company_code', '!=', 'CR'),('type','!=','out_refund'),('debit_note','=',False)]}"/>                  
     </field>
    </field>
  </record>
    
     <record id="account.action_move_out_invoice_type" model="ir.actions.act_window">
      <field name="domain">[('type', '=', 'out_invoice'),('debit_note', '=', False)]</field>
  </record>

  <record id="action_for_debit_notes" model="ir.actions.act_window">
      <field name="name">Debit Notes</field>
      <field name="res_model">account.move</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="account.view_invoice_tree"/>
      <field name="domain">[('debit_note', '=', True)]</field>
      <field name="context">{'default_type':'out_invoice','default_debit_note': True}</field>
  </record>

  <menuitem
      id="menu_for_debit_note_invoices"
      parent="account.menu_finance_receivables"
      action="action_for_debit_notes"
      sequence="5"
  /> 
    
    
    
    
</odoo>

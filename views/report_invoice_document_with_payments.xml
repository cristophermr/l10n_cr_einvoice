<odoo>
<template id="l10n_cr_einvoice.report_invoice_document_with_payments_inherit" inherit_id="account.report_invoice_document_with_payments">
  <xpath expr="/t/t/div/h2" position="before">
      <t t-if="o.fe_current_country_company_code == 'CR'" >
            <t t-set="address" position="replace"/>
            <table class="table table-borderless mt-4 mb-4">
            <tbody>
            <tr>
            <td><strong>Cliente:</strong></td>
            <td><span t-field="o.partner_id.name"/></td>
            <td><strong>Identificación:</strong></td>
            <td><span t-field="o.partner_id.vat"/></td>
            </tr>
            <tr>
            <td><strong>Correo electrónico:</strong></td>
            <td><span t-field="o.partner_id.email"/></td>
            <td><strong>Teléfono:</strong></td>
            <td><span t-field="o.partner_id.phone"/></td>
            </tr>
            <tr>
            <td><strong>Dirección:</strong></td>
            <td colspan = "3">
            <span t-field="o.partner_id.state_id"/> 
            <span t-field="o.partner_id.canton_id"/>
            <span t-field="o.partner_id.distrito_id"/>
            <span t-field="o.partner_id.barrio_id"/>
            <span t-field="o.partner_id.street"/>
            </td>
            </tr>
            </tbody>
            </table>
      </t>
  </xpath>

  <xpath expr="/t/t/div/h2"
      position="after">
      <div class="row" t-if="o.fe_current_country_company_code == 'CR'" >
        <div class="col-12">
          <span>
            <strong>Clave:</strong>
          </span>
          <span t-field="o.fe_clave" />
        </div>
      </div>
    </xpath>
    <div id="informations" class="row mt32 mb32" position="after">
         <div class="row" t-if="o.currency_id.name != 'CRC'">
              <div class="col-12">
                  <strong>Tipo Cambio: </strong><span t-esc="'%.2f'%(1/o.currency_id.rate)"/>
              </div>
         </div>
   </div>
   <xpath expr="/t/t/div/table/thead/tr/th[1]" position="after">
    <th>
      <span>Código Cabys</span>
    </th>
  </xpath>
    <xpath expr="/t/t/div/table/tbody/t[3]/tr/t[1]/td[1]" position="after">
      <td>
        <span t-field="line.product_id.cabys_code_id.code"/>
      </td>
    </xpath>
    <xpath expr="/t/t/div/table/tbody/t[3]/t[3]/tr/td" position="attributes">
      <attribute name="colspan">100</attribute>
    </xpath>
   
    <xpath expr="/t/t/div/div[3]/div"
           position="replace">
      <div class="row">
        <div class="col-6">
          <table class="table table-sm"
                 style="page-break-inside: avoid;" t-if="o.fe_current_country_company_code == 'CR'">
            <tr class=""
                style="">
              <td>Servicios gravados</td>
              <td class="text-right">
                <span t-field="o.fe_total_servicio_gravados" />
              </td>
            </tr>
            <tr class=""
                style="">
              <td>Servicios exentos</td>
              <td class="text-right">
                <span t-field="o.fe_total_servicio_exentos" />
              </td>
            </tr>
            <tr class=""
                style="">
              <td>Mercancias gravadas</td>
              <td class="text-right">
                <span t-field="o.fe_total_mercancias_gravadas" />
              </td>
            </tr>
            <tr class=""
                style="">
              <td>Mercancias exentas</td>
              <td class="text-right">
                <span t-field="o.fe_total_mercancias_exentas" />
              </td>
            </tr>
            <tr class=""
                style="">
              <td>Servicios exonerados</td>
              <td class="text-right">
                <span t-field="o.TotalServExonerado" />
              </td>
            </tr>
            <tr class=""
                style="">
              <td>Mercancias exonerados</td>
              <td class="text-right">
                <span t-field="o.TotalMercExonerada" />
              </td>
            </tr>
          </table>
        </div>
        <div class="col-6">
          <table class="table table-sm"
                 style="page-break-inside: avoid;">
            <tr class=""
                style="" t-if="o.fe_current_country_company_code == 'CR'" >
              <td>Tolal exonerado</td>
              <td class="text-right">
                <span t-field="o.TotalExonerado" />
              </td>
            </tr>
            <tr class=""
                style="" t-if="o.fe_current_country_company_code == 'CR'" >
              <td>Tolal gravado</td>
              <td class="text-right">
                <span t-field="o.fe_total_gravado" />
              </td>
            </tr>
            <tr class=""
                style="" t-if="o.fe_current_country_company_code == 'CR'">
              <td>Total exento</td>
              <td class="text-right">
                <span t-field="o.fe_total_exento" />
              </td>
            </tr>
            <tr class=""
                style="">
              <td>
                <strong>Subtotal</strong>
              </td>
              <td class="text-right">
                <span t-field="o.amount_untaxed" />
              </td>
            </tr>
            <tr class="border-black o_subtotal"
                style="" t-if="o.fe_current_country_company_code == 'CR'">
              <td>Descuento</td>
              <td class="text-right">
                <span t-field="o.fe_total_descuento" />
              </td>
            </tr>
            <t t-foreach="o.amount_by_group"
               t-as="amount_by_group">
              <tr style="">
                <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) in [0, 1] and o.amount_untaxed == amount_by_group[2]">
                  <td>
                    <span class="text-nowrap"
                          t-esc="amount_by_group[0]" />
                  </td>
                  <td class="text-right o_price_total">
                    <span class="text-nowrap"
                          t-esc="amount_by_group[3]" />
                  </td>
                </t>
                <t t-else="">
                  <td>
                    <span t-esc="amount_by_group[0]" />
                    <span class="text-nowrap"> on
                    <t t-esc="amount_by_group[4]" />
                  </span>
                </td>
                <td class="text-right o_price_total">
                  <span class="text-nowrap"
                        t-esc="amount_by_group[3]" />
                </td>
              </t>
            </tr>
          </t>
          <tr class="border-black o_total">
            <td>
              <strong>Total</strong>
            </td>
            <td class="text-right">
              <span class="text-nowrap"
                    t-field="o.amount_total" />
            </td>
          </tr>
        </table>
      </div>
    </div>
  </xpath>

  <xpath expr="/t/t/div/div[3]/div" position="after">

      <div class="row" t-if="o.fe_current_country_company_code == 'CR'">
        <div class="col-12" t-if="o.fiscal_position_id">
          <div>
            <p><strong>Detalle de la Exoneración</strong></p>
            <span>Tipo del Documento: </span>
            <span t-field="o.fiscal_position_id.fiscal_position_type"/>
            <span>, Número de Exoneración: </span>
            <span t-field="o.fiscal_position_id.document_number"/>
          </div>

          <div>
            <span t-field="o.fiscal_position_id.tax_ids.tax_dest_id.codigo_impuesto"/>
            <span>, </span>
            <span t-field="o.fiscal_position_id.tax_ids.tax_dest_id.tarifa_impuesto"/>
          </div>

          <div>
            <span>Emitido por: </span>
            <span t-field="o.fiscal_position_id.institution_name"/>
            <span>, Fecha: </span>
            <span t-field="o.fiscal_position_id.issued_date"/>
          </div>

        </div>

      </div>
      <br/>
    </xpath>

</template>
</odoo>